# cocotte-date
日時フォーマット関数

# はじめに

日時をフォーマットする関数を提供します  
ベースはPHPの[date関数](http://php.net/manual/ja/function.date.php)で、同じようなパラメータ文字列で実現しています  
また、日本の年号や祝日に対応しています

# 使用方法

定義

  `{String} date_format ( {Date|String} date [, {String} format, [{Number} eigyobi]] )`  
  formatの既定値は`'Y-m-d H:i:s'`です
  eigyobiの既定値は設定されていません

例

```
data_format(new Date('2015-4-27'), 'Y/m/d');  // '2015/4/27'
data_format('2015-4-27', 'Y/m/d');  // '2015/4/27'
```

２つめのように日付をあらわす文字列を直接引数にしてもかまいません


次のようにすると翌営業日を表示します

```
data_format('2015-5-4', 'Y/m/d', 1);  // '2015/5/7'
```


# 和暦

和暦は年区切りと日付区切りの両方をサポートしています

| 年号 | 年区切りの期間 | 日付区切りの期間      |
|------|--------------- |-----------------------|
| 平成 | 1989年-        | 1989/01/08-           |
| 昭和 | 1926年-1988年  | 1926/12/25-1989/01/07 |
| 大正 | 1912年-1925年  | 1912/07/30-1926/12/24 |
| 明治 | 1868年-1911年  | 1868/01/25-1912/07/29 |

1868年から明治ですが、グレゴリオ歴の導入は1873年（明治6年）以降のため、それ以前は和暦は旧暦のこよみになります。  
そのため、1872年以前で和暦の変換を行うと西暦表示になります

# 祝日

祝日は、1948年7月20日に施行された祝日法に基づき計算されています  
祝日データは2015年4月29日時点で決定されているものが反映されています  
（2016年から新しく施行される山の日まで)

祝日を得ることは、フォーマットとは別に行いたい場合があるかもしれせん  
ある年の祝日の一覧を取得したい場合は次でできます

```
var holidays = data_format.getHolidays(2015);
```


# パラメータ文字列

以下の文字が format パラメータ文字列として認識されます

| 文字     | 説明                                                                | 戻り値の例       |
|----------|---------------------------------------------------------------------|------------------|
| hizuke   | 日付 `Y/m/d`を指定したのと同じ                                      | 2015/04/06       |
| wareki   | 和暦 年区切り   `nengonen年n月j日`を指定したのと同じ                | 平成1年1月7日    |
| wareki2  | 和暦 日付区切り `NengoNen年n月j日`を指定したのと同じ                | 昭和64年1月7日   |
| Y        | 年 ４桁                                                             | 2014             |
| y        | 年 下２桁                                                           | 14               |
| L        | うるう年判定  1:うるう年、0:平年                                    | 1, 0             |
| nengo    | 和暦 年区切り 年号 1872年以前は西暦                                 | 昭和, 平成       |
| nengo2   | 和暦 年区切り 年号 省略表示                                         | S, H             |
| nen      | 和暦 年区切り 年                                                    | 1, 27            |
| nen2     | 和暦 年区切り 年   1は元                                            | 元, 27           |
| nen3     | 和暦 年区切り 年   1は元 その他は漢数字                             | 元, 二十七       |
| nen4     | 和暦 年区切り 年   1は元 その他は漢数字(省略形)                     | 元, 二七         |
| Nengo    | 和暦 日付区切り 年号 1872年以前は西暦                               | 昭和, 平成       |
| Nengo2   | 和暦 日付区切り 年号 省略表示                                       | S, H             |
| Nen      | 和暦 日付区切り 年                                                  | 1, 27            |
| Nen2     | 和暦 日付区切り 年   1は元                                          | 元, 27           |
| Nen3     | 和暦 日付区切り 年   1は元 その他は漢数字                           | 元, 二十七       |
| Nen4     | 和暦 日付区切り 年   1は元 その他は漢数字(省略形)                   | 元, 二七         |
| m        | 月 0あり                                                            | 08, 12           |
| n        | 月 0なし                                                            | 8, 12            |
| F        | 月 英語                                                             | August           |
| M        | 月 英語 省略形                                                      | Aug              |
| tuki     | 月 漢数字                                                           | 八, 十二         |
| tuki2    | 月 漢数字 省略形                                                    | 八, 一二         |
| t        | 月の日数                                                            | 28, 29, 30, 31   |
| W        | 週番号   年の第何週目かを示す                                       | 42               |
| d        | 日 0あり                                                            | 05, 15, 25       |
| j        | 日 0なし                                                            | 5, 15, 25        |
| niti     | 日 漢数字                                                           | 五, 十五, 二十五 |
| niti2    | 日 漢数字 省略形                                                    | 五, 一五, 二五   |
| S        | 接頭語                                                              | st, nd, rd, th   |
| z        | 年通算日数  0から開始                                               | 0, 38, 364       |
| w        | 曜日 日:0 -> 土:6                                                   | 0, 6             |
| N        | 曜日 月:1 -> 日:7                                                   | 1, 7             |
| l        | 曜日 英語                                                           | Monday           |
| D        | 曜日 英語 省略形                                                    | Mon              |
| yobi     | 曜日 日本語 省略形                                                  | 月, 火, 水       |
| yobi2    | 曜日 日本語 省略形 祝日は曜日の代わりに祝                           | 月, 火, 祝       |
| yobi3    | 曜日 日本語 祝日は曜日の代わりに祝日                                | 月曜日, 祝日     |
| holiday  | 祝日名 日本語 祝日でない場合は空文字                                | 元日, 成人の日   |
| g        | 時 12時間制 0なし                                                   | 3, 9             |
| G        | 時 24時間制 0なし                                                   | 3, 9, 15         |
| h        | 時 12時間制 0あり                                                   | 03, 09           |
| H        | 時 24時間制 0あり                                                   | 03, 09, 15       |
| u        | マイクロ秒 0あり (ミリ秒までしか計測できないので下3桁は常に0になる) | 065000           |
| a        | am/pm                                                               | am, pm           |
| A        | AM/PM                                                               | AM, PM           |
| aj       | 午前/午後                                                           | 午前, 午後       |



# 和暦での入力

和暦の入力は限定的に許可されています

  + 指定できるのは日付のみ
  + 数字は半角のみ
  + 平成,昭和,大正,明治,H,S,T,Mで始まり、年がそれに続く
  + 明治元年から5年は旧暦のため非対応(正しい結果ではありません)
  + 年、月、日の各数字の間に数字以外の文字が存在すること

この条件で入力を受け付ける例

  + 昭和50年1月2日
  + S50-1-2
  + H1 10 10

`date_format('S50-1-1', 'Y/m/d') // 1975/01/01`


# 営業日

関数の第三引数に数値を設定した場合の営業日の計算方法は、次のとおりです

  + 日本の祝日を適用
  + 土日を定休日とする
  + 年末年始は12/29-1/3を休業日とする

あくまで簡易的な機能のため、上記の条件以外で営業日の計算を行いたい場合は、
次の関数であらかじめ日付を算出し、第一引数に設定する必要があります

`var eigyobi = date_format.addEigyobi(date, days, include, season, regular, holidays)`

  + date
    + 基準となる日時です
    + DateもしくはString
    + 必須です
    + 日にちの部分は変更されます
    + 時間部分の値は変化しません
  + days
    + カウントする営業日数
    + 必須です
    + 1以上の場合は、翌営業日からカウントして算出します
    + 0の場合は、dataが営業日であればdateを、そうでない場合は翌営業日を返します
    + -1以下の場合は、さかのぼって算出します
  + include
    + trueの場合、dateもカウントの対象に含みます
    + 既定値はfalseです
    + daysが0の場合はincludeは無視されます
  + season
    + 年末年始/お盆の休みを指定することができます
    + 文字列で休みの日にちもしくは期間を指定してください。複数指定する場合はカンマ区切り
    + 既定値は'12/29-1/3'です
    + 例えばお盆休業も追加するには、'12/29-1/3, 8/13-8/16'などと指定します
  + regular
    + 定休日を指定します
    + 文字列で曜日を記述します複数ある場合はカンマ区切り
    + 既定値は'土,日'です
    + 関数を指定した場合は、引数に日にちが渡され休みの場合にtrue、営業日にfalseを返すようにします
  + holidays
    + 月/日をカンマ区切りで指定することで祝日を指定することができます
    + 設定しない場合は、日本の祝日を自動計算し休業日とします
    + 関数を指定した場合は、引数に日にちが渡され休みの場合にtrue、営業日にfalseを返すようにします

基準となる日時より１年先（前）以内に営業日が存在しなかった場合はnullが返されます

# エスケープ

文字のエスケープはphpのdate関数と異なり、`{}`を使用します  
一箇所でも`{}`が含まれているとエスケープが有効になります  
`{}`で囲った部分をパラメータ文字列と認識し
その他の文字はすべてそのまま表示されるようになります

```
data_format('2015-4-27', '{Y}/{m}/{d} updated');  // '2015/4/27 updated'
```

